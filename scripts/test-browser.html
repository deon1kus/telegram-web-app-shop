<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram –∫–∞–Ω–∞–ª–æ–º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1890ff;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
            border-left: 4px solid #1890ff;
        }
        
        .test-section h2 {
            color: #1890ff;
            margin-bottom: 15px;
        }
        
        .test-item {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: 1px solid #e8e8e8;
        }
        
        .test-item h3 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .result {
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #389e0d;
        }
        
        .error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #cf1322;
        }
        
        .info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #0050b3;
        }
        
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-top: 10px;
        }
        
        button:hover {
            background: #40a9ff;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
        }
        
        .stat-item {
            flex: 1;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #1890ff;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram –∫–∞–Ω–∞–ª–æ–º</h1>
        <p class="subtitle">–í–µ—Ä—Å–∏—è 0.0.2 | –ö–∞–Ω–∞–ª —Ç–æ–≤–∞—Ä–æ–≤: -1003271699368 | –ö–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: -1003018207910</p>
        
        <div class="stats" id="stats">
            <div class="stat-item">
                <div class="stat-value" id="passed">0</div>
                <div class="stat-label">–ü—Ä–æ–π–¥–µ–Ω–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="failed">0</div>
                <div class="stat-label">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="total">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="rate">0%</div>
                <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
            </div>
        </div>
        
        <button onclick="runAllTests()">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
        <button onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        
        <div class="test-section">
            <h2>üìã –¢–µ—Å—Ç 1: –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–∞</h2>
            <div id="test1"></div>
        </div>
        
        <div class="test-section">
            <h2>üìé –¢–µ—Å—Ç 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
            <div id="test2"></div>
        </div>
        
        <div class="test-section">
            <h2>üì¢ –¢–µ—Å—Ç 3: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h2>
            <div id="test3"></div>
        </div>
        
        <div class="test-section">
            <h2>üî¢ –¢–µ—Å—Ç 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ product_id –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ</h2>
            <div id="test4"></div>
        </div>
        
        <div class="test-section">
            <h2>üîÑ –¢–µ—Å—Ç 5: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã</h2>
            <div id="test5"></div>
        </div>
    </div>
    
    <script>
        // –§—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
        function parseProductMessage(message) {
            if (!message) return null;
            
            const result = { messageId: message.message_id || message.messageId };
            const text = message.caption || message.text || '';
            
            if (!text && !message.photo) return null;
            
            if (message.photo && message.photo.length > 0) {
                result.photoFileId = message.photo[message.photo.length - 1].file_id;
            }
            
            const descMatch = text.match(/üìù\s*(.+?)(?=\n(?:üí∞|üì¶|üè∑Ô∏è|üìû|#)|$)/s);
            if (descMatch) {
                result.description = descMatch[1].trim();
            } else if (text) {
                const firstMarker = text.match(/(üí∞|üì¶|üè∑Ô∏è|üìû|#)/);
                result.description = firstMarker ? text.substring(0, firstMarker.index).trim() : text.trim();
            }
            
            const priceMatch = text.match(/üí∞\s*–¶–µ–Ω–∞:\s*(\d+(?:\s*\d+)*)\s*—Ç–æ–º–∞–Ω/i);
            if (priceMatch) {
                result.price = parseInt(priceMatch[1].replace(/\s+/g, ''), 10);
            }
            
            const qtyMatch = text.match(/üì¶\s*–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:\s*(\d+)\s*—à—Ç/i);
            if (qtyMatch) {
                result.quantity = parseInt(qtyMatch[1], 10);
            }
            
            const catMatch = text.match(/üè∑Ô∏è\s*–ö–∞—Ç–µ–≥–æ—Ä–∏—è:\s*(.+?)(?=\n|$)/i);
            if (catMatch) {
                result.category = catMatch[1].trim();
            }
            
            return result;
        }
        
        function validateParsedProduct(parsed) {
            return parsed && parsed.description && parsed.price && parsed.price > 0;
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function generateMessageLink(chatId, messageId) {
            return `https://t.me/c/${chatId.toString().replace(/^-100/, '')}/${messageId}`;
        }
        
        function formatProductNotification(name, id, link) {
            return `üÜï –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä #${id}\n\nüì¶ ${name}\n\nüîó ${link}`;
        }
        
        function addProductIdToMessage(text, id) {
            return `${text.replace(/#product_id[:\s]*\d+/gi, '').trim()}\n\n#product_id:${id}`;
        }
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const testMessages = [
            {
                message_id: 6,
                caption: `üìù –ù–æ–≤—ã–π iPhone 15 Pro Max 256GB

üí∞ –¶–µ–Ω–∞: 150000 —Ç–æ–º–∞–Ω
üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 5 —à—Ç
üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞`
            },
            {
                message_id: 7,
                text: `üìù –ü—Ä–æ—Å—Ç–æ–π —Ç–æ–≤–∞—Ä

üí∞ –¶–µ–Ω–∞: 5000 —Ç–æ–º–∞–Ω`
            }
        ];
        
        let testsPassed = 0;
        let testsFailed = 0;
        
        function addResult(containerId, title, success, details) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = 'test-item';
            div.innerHTML = `
                <h3>${title} ${success ? '‚úÖ' : '‚ùå'}</h3>
                <div class="result ${success ? 'success' : 'error'}">${details}</div>
            `;
            container.appendChild(div);
            
            if (success) testsPassed++;
            else testsFailed++;
            updateStats();
        }
        
        function updateStats() {
            const total = testsPassed + testsFailed;
            const rate = total > 0 ? ((testsPassed / total) * 100).toFixed(1) : 0;
            
            document.getElementById('passed').textContent = testsPassed;
            document.getElementById('failed').textContent = testsFailed;
            document.getElementById('total').textContent = total;
            document.getElementById('rate').textContent = rate + '%';
        }
        
        function clearResults() {
            ['test1', 'test2', 'test3', 'test4', 'test5'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            testsPassed = 0;
            testsFailed = 0;
            updateStats();
        }
        
        function runAllTests() {
            clearResults();
            
            // –¢–µ—Å—Ç 1: –ü–∞—Ä—Å–∏–Ω–≥
            testMessages.forEach((msg, i) => {
                const parsed = parseProductMessage(msg);
                const valid = validateParsedProduct(parsed);
                const details = `Message ID: ${parsed?.messageId}\n–û–ø–∏—Å–∞–Ω–∏–µ: ${parsed?.description || '–ù–ï–¢'}\n–¶–µ–Ω–∞: ${parsed?.price || '–ù–ï–¢'}\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${parsed?.quantity || '–ù–ï–¢'}`;
                addResult('test1', `–°–æ–æ–±—â–µ–Ω–∏–µ ${i + 1}`, valid, details);
            });
            
            // –¢–µ—Å—Ç 2: –°—Å—ã–ª–∫–∏
            const link1 = generateMessageLink('-1003271699368', 6);
            const link2 = generateMessageLink('-1003018207910', 123);
            addResult('test2', '–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª —Ç–æ–≤–∞—Ä–æ–≤', link1 === 'https://t.me/c/3271699368/6', link1);
            addResult('test2', '–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', link2 === 'https://t.me/c/3018207910/123', link2);
            
            // –¢–µ—Å—Ç 3: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const notification = formatProductNotification('–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä', 1, 'https://t.me/c/3271699368/6');
            const hasAll = notification.includes('üÜï') && notification.includes('#1') && notification.includes('https://');
            addResult('test3', '–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', hasAll, notification);
            
            // –¢–µ—Å—Ç 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ ID
            const original = 'üìù –¢–æ–≤–∞—Ä\nüí∞ –¶–µ–Ω–∞: 10000 —Ç–æ–º–∞–Ω';
            const withId = addProductIdToMessage(original, 1);
            const hasId = withId.includes('#product_id:1');
            addResult('test4', '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ product_id', hasId, `–ò—Å—Ö–æ–¥–Ω–æ–µ:\n${original}\n\n–° ID:\n${withId}`);
            
            // –¢–µ—Å—Ç 5: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª
            const parsed = parseProductMessage(testMessages[0]);
            if (parsed && validateParsedProduct(parsed)) {
                const link = generateMessageLink('-1003271699368', 6);
                const updated = addProductIdToMessage(testMessages[0].caption, 1);
                const notif = formatProductNotification(parsed.description, 1, link);
                const fullCycle = `1. –ü–∞—Ä—Å–∏–Ω–≥: ‚úÖ\n2. –°—Å—ã–ª–∫–∞: ${link}\n3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ‚úÖ\n4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: ‚úÖ\n\n–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:\n${notif}`;
                addResult('test5', '–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª', true, fullCycle);
            } else {
                addResult('test5', '–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª', false, '–ü–∞—Ä—Å–∏–Ω–≥ –Ω–µ –ø—Ä–æ—à–µ–ª');
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            console.log('–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã"');
        };
    </script>
</body>
</html>

